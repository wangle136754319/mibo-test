# 代码工具

## paramiko SSH工具
```py
import paramiko
import time


class UseSSH:
    def __init__(self):
        # 创建 SSH 客户端对象
        ssh = paramiko.SSHClient()

        # 自动添加主机密钥
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        # 使用密钥连接 SSH 服务器
        private_key_path = "C:\\Users\\MIBO\\.ssh\\id_rsa"
        ssh.connect(hostname="10.44.3.66", username="root", key_filename=private_key_path)
        self.objssh = ssh

    def exec_cmd(self, cmd):
        # 普通执行命令
        stdin, stdout, stderr = self.objssh.exec_command(cmd)
        output = stdout.read().decode()
        print(output)

    def exec_invoke_cmd(self, k_andv: dict):
        # 创建交互式 shell
        channel = self.objssh.invoke_shell()

        for cmd, out in k_andv.items():
            channel.send(cmd + '\n')

            output = ""
            # 用于检查 SSH 会话中是否有可读取的数据。该方法会在没有可读取数据时阻塞，直到 SSH 会话中有数据可供读取或发生超时为止。
            while not channel.recv_ready():
                time.sleep(0.5)
                continue
            while channel.recv_ready():
                # 不要慌，多等下输出，有些机器反应慢
                time.sleep(0.5)
                output += channel.recv(4096).decode()

            if out in output:
                print(f"** {cmd} - 执行成功")
            else:
                print(f"!! {cmd} - 执行失败")
            print(output)
            print("=" * 30)
        channel.close()

    def __del__(self):
        print("销毁ssh")
        self.objssh.close()


cc = UseSSH()
cc.exec_cmd('ls')

k_andv = {"ls -al": "mibo", "ifconfig": "RUNNING"}
cc.exec_invoke_cmd(k_andv)



```

##  linux 检查网络是否正常，不正常则重启系统
```bash
#!/bin/bash


# 监听的IP地址,最好是网关
HOST="10.24.255.254" 

# 超时时间，单位秒
TIMEOUT=15

# 企业微信的通知
webhook="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=eb5e0e9a-1453-4a24-ba5f-be394742afbe"



# 发送微信消息
send_weixin_msg() {
	echo $1
	devs=$1
	curl "$webhook" \
   -H 'Content-Type: application/json' \
   -d '
   {
        "msgtype": "text",
        "text": {
            "content": "网络正常，我还活着'$devs'"
        }
   }'
}



# 循环监听
while true
do
    # 发送ping请求
    ping -c 1 -W $TIMEOUT $HOST > /dev/null

    # 检查是否收到ping响应；每隔10秒汇报一次自己还活着的消息
    if [ $? -ne 0 ]; then
        echo "No response from $HOST. Rebooting..."
        reboot -f
	else
		devis=`hostnamectl --static`
		send_weixin_msg $devis
		echo "network connectivity"
    fi

    # 等待一段时间后再次发送ping请求
    sleep 5
done



```